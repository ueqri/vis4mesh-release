function t(t){return t&&t.__esModule?t.default:t}class e{constructor(t,e){this.startTime=this.endTime=0,this.port=t,this.view=e,this.modules=new Array}loadModules(t){return this.modules=[...this.modules,...t],t.forEach((t=>t.invokeController(this))),this}requestDataPort(){this.port.range(this.startTime,this.endTime).then((t=>{let e={meta:t.meta,nodes:t.nodes,edges:t.edges};this.modules.forEach((n=>{n.decorateData(t,e)})),this.view.renderData(e)}),(t=>{console.error(t)}))}}function n(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function r(t){let e=t,r=t,i=t;function o(t,e,n=0,o=t.length){if(n<o){if(0!==r(e,e))return o;do{const r=n+o>>>1;i(t[r],e)<0?n=r+1:o=r}while(n<o)}return n}return 2!==t.length&&(e=(e,n)=>t(e)-n,r=n,i=(e,r)=>n(t(e),r)),{left:o,center:function(t,n,r=0,i=t.length){const a=o(t,n,r,i-1);return a>r&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,n=0,o=t.length){if(n<o){if(0!==r(e,e))return o;do{const r=n+o>>>1;i(t[r],e)<=0?n=r+1:o=r}while(n<o)}return n}}}const i=r(n),o=i.right;i.left,r((function(t){return null===t?NaN:+t})).center;var a=o;class s extends Map{constructor(t,e=f){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(l(this,t))}has(t){return super.has(l(this,t))}set(t,e){return super.set(c(this,t),e)}delete(t){return super.delete(h(this,t))}}class u extends Set{constructor(t,e=f){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const e of t)this.add(e)}has(t){return super.has(l(this,t))}add(t){return super.add(c(this,t))}delete(t){return super.delete(h(this,t))}}function l({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function c({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function h({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function f(t){return null!==t&&"object"==typeof t?t.valueOf():t}function d(t){return t}function p(t,e){for(let n=1,r=e.length;n<r;++n)t=t.flatMap((t=>t.pop().map((([e,n])=>[...t,e,n]))));return t}function g(t,e,...n){return p(function(t,e,...n){return m(t,Array.from,e,n)}(t,e,...n),n)}function m(t,e,n,r){return function t(i,o){if(o>=r.length)return n(i);const a=new s,u=r[o++];let l=-1;for(const t of i){const e=u(t,++l,i),n=a.get(e);n?n.push(t):a.set(e,[t])}for(const[e,n]of a)a.set(e,t(n,o));return e(a)}(t,0)}function y(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}function v(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}var w=Math.sqrt(50),b=Math.sqrt(10),_=Math.sqrt(2);function x(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=w?10:o>=b?5:o>=_?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=w?10:o>=b?5:o>=_?2:1)}function k(t,e){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof e)throw new TypeError("mapper is not a function");return Array.from(t,((n,r)=>e(n,r,t)))}function M(t){return t}function S(t){return"translate("+t+",0)"}function A(t){return"translate(0,"+t+")"}function E(t){return e=>+t(e)}function C(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function N(){return!this.__axis}function T(t,e){var n=[],r=null,i=null,o=6,a=6,s=3,u="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,l=1===t||4===t?-1:1,c=4===t||2===t?"x":"y",h=1===t||3===t?S:A;function f(f){var d=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,p=null==i?e.tickFormat?e.tickFormat.apply(e,n):M:i,g=Math.max(o,0)+s,m=e.range(),y=+m[0]+u,v=+m[m.length-1]+u,w=(e.bandwidth?C:E)(e.copy(),u),b=f.selection?f.selection():f,_=b.selectAll(".domain").data([null]),x=b.selectAll(".tick").data(d,e).order(),k=x.exit(),S=x.enter().append("g").attr("class","tick"),A=x.select("line"),T=x.select("text");_=_.merge(_.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(S),A=A.merge(S.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),T=T.merge(S.append("text").attr("fill","currentColor").attr(c,l*g).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),f!==b&&(_=_.transition(f),x=x.transition(f),A=A.transition(f),T=T.transition(f),k=k.transition(f).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=w(t))?h(t+u):this.getAttribute("transform")})),S.attr("opacity",1e-6).attr("transform",(function(t){var e=this.parentNode.__axis;return h((e&&isFinite(e=e(t))?e:w(t))+u)}))),k.remove(),_.attr("d",4===t||2===t?a?"M"+l*a+","+y+"H"+u+"V"+v+"H"+l*a:"M"+u+","+y+"V"+v:a?"M"+y+","+l*a+"V"+u+"H"+v+"V"+l*a:"M"+y+","+u+"H"+v),x.attr("opacity",1).attr("transform",(function(t){return h(w(t)+u)})),A.attr(c+"2",l*o),T.attr(c,l*g).text(p),b.filter(N).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),b.each((function(){this.__axis=w}))}return f.scale=function(t){return arguments.length?(e=t,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(t){return arguments.length?(n=null==t?[]:Array.from(t),f):n.slice()},f.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),f):r&&r.slice()},f.tickFormat=function(t){return arguments.length?(i=t,f):i},f.tickSize=function(t){return arguments.length?(o=a=+t,f):o},f.tickSizeInner=function(t){return arguments.length?(o=+t,f):o},f.tickSizeOuter=function(t){return arguments.length?(a=+t,f):a},f.tickPadding=function(t){return arguments.length?(s=+t,f):s},f.offset=function(t){return arguments.length?(u=+t,f):u},f}var D={value:()=>{}};function z(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new R(r)}function R(t){this._=t}function O(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function $(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function P(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=D,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}R.prototype=z.prototype={constructor:R,on:function(t,e){var n,r=this._,i=O(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=P(r[n],t.name,e);else if(null==e)for(n in r)r[n]=P(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=$(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new R(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var X=z,B={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function F(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),B.hasOwnProperty(e)?{space:B[e],local:t}:t}function Y(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return"http://www.w3.org/1999/xhtml"===n&&"http://www.w3.org/1999/xhtml"===e.documentElement.namespaceURI?e.createElement(t):e.createElementNS(n,t)}}function q(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function I(t){var e=F(t);return(e.local?q:Y)(e)}function L(){}function G(t){return null==t?L:function(){return this.querySelector(t)}}function j(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function W(){return[]}function V(t){return function(e){return e.matches(t)}}var H=Array.prototype.find;function K(){return this.firstElementChild}var U=Array.prototype.filter;function Z(){return Array.from(this.children)}function J(t){return new Array(t.length)}function Q(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function tt(t){return function(){return t}}function et(t,e,n,r,i,o){for(var a,s=0,u=e.length,l=o.length;s<l;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new Q(t,o[s]);for(;s<u;++s)(a=e[s])&&(i[s]=a)}function nt(t,e,n,r,i,o,a){var s,u,l,c=new Map,h=e.length,f=o.length,d=new Array(h);for(s=0;s<h;++s)(u=e[s])&&(d[s]=l=a.call(u,u.__data__,s,e)+"",c.has(l)?i[s]=u:c.set(l,u));for(s=0;s<f;++s)l=a.call(t,o[s],s,o)+"",(u=c.get(l))?(r[s]=u,u.__data__=o[s],c.delete(l)):n[s]=new Q(t,o[s]);for(s=0;s<h;++s)(u=e[s])&&c.get(d[s])===u&&(i[s]=u)}function rt(t){return t.__data__}function it(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function ot(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function at(t){return function(){this.removeAttribute(t)}}function st(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ut(t,e){return function(){this.setAttribute(t,e)}}function lt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ct(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function ht(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function ft(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function dt(t){return function(){this.style.removeProperty(t)}}function pt(t,e,n){return function(){this.style.setProperty(t,e,n)}}function gt(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function mt(t,e){return t.style.getPropertyValue(e)||ft(t).getComputedStyle(t,null).getPropertyValue(e)}function yt(t){return function(){delete this[t]}}function vt(t,e){return function(){this[t]=e}}function wt(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function bt(t){return t.trim().split(/^|\s+/)}function _t(t){return t.classList||new xt(t)}function xt(t){this._node=t,this._names=bt(t.getAttribute("class")||"")}function kt(t,e){for(var n=_t(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Mt(t,e){for(var n=_t(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function St(t){return function(){kt(this,t)}}function At(t){return function(){Mt(this,t)}}function Et(t,e){return function(){(e.apply(this,arguments)?kt:Mt)(this,t)}}function Ct(){this.textContent=""}function Nt(t){return function(){this.textContent=t}}function Tt(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Dt(){this.innerHTML=""}function zt(t){return function(){this.innerHTML=t}}function Rt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Ot(){this.nextSibling&&this.parentNode.appendChild(this)}function $t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Pt(){return null}function Xt(){var t=this.parentNode;t&&t.removeChild(this)}function Bt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ft(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Yt(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function qt(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function It(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Lt(t,e,n){var r=ft(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Gt(t,e){return function(){return Lt(this,t,e)}}function jt(t,e){return function(){return Lt(this,t,e.apply(this,arguments))}}Q.prototype={constructor:Q,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},xt.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Wt=[null];function Vt(t,e){this._groups=t,this._parents=e}function Ht(){return new Vt([[document.documentElement]],Wt)}Vt.prototype=Ht.prototype={constructor:Vt,select:function(t){"function"!=typeof t&&(t=G(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=e[i],u=s.length,l=r[i]=new Array(u),c=0;c<u;++c)(o=s[c])&&(a=t.call(o,o.__data__,c,s))&&("__data__"in o&&(a.__data__=o.__data__),l[c]=a);return new Vt(r,this._parents)},selectAll:function(t){var e;"function"==typeof t?t=function(t){return function(){return j(t.apply(this,arguments))}}(t):t=null==(e=t)?W:function(){return this.querySelectorAll(e)};for(var n=this._groups,r=n.length,i=[],o=[],a=0;a<r;++a)for(var s,u=n[a],l=u.length,c=0;c<l;++c)(s=u[c])&&(i.push(t.call(s,s.__data__,c,u)),o.push(s));return new Vt(i,o)},selectChild:function(t){return this.select(null==t?K:function(t){return function(){return H.call(this.children,t)}}("function"==typeof t?t:V(t)))},selectChildren:function(t){return this.selectAll(null==t?Z:function(t){return function(){return U.call(this.children,t)}}("function"==typeof t?t:V(t)))},filter:function(t){var e;"function"!=typeof t&&(e=t,t=function(){return this.matches(e)});for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o)for(var a,s=n[o],u=s.length,l=i[o]=[],c=0;c<u;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Vt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,rt);var n=e?nt:et,r=this._parents,i=this._groups;"function"!=typeof t&&(t=tt(t));for(var o=i.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;l<o;++l){var c=r[l],h=i[l],f=h.length,d=it(t.call(c,c&&c.__data__,l,r)),p=d.length,g=s[l]=new Array(p),m=a[l]=new Array(p),y=u[l]=new Array(f);n(c,h,g,m,y,d,e);for(var v,w,b=0,_=0;b<p;++b)if(v=g[b]){for(b>=_&&(_=b+1);!(w=m[_])&&++_<p;);v._next=w||null}}return(a=new Vt(a,r))._enter=s,a._exit=u,a},enter:function(){return new Vt(this._enter||this._groups.map(J),this._parents)},exit:function(){return new Vt(this._exit||this._groups.map(J),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),s=new Array(i),u=0;u<a;++u)for(var l,c=n[u],h=r[u],f=c.length,d=s[u]=new Array(f),p=0;p<f;++p)(l=c[p]||h[p])&&(d[p]=l);for(;u<i;++u)s[u]=n[u];return new Vt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=ot);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],u=s.length,l=i[o]=new Array(u),c=0;c<u;++c)(a=s[c])&&(l[c]=a);l.sort(e)}return new Vt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=F(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?st:at:"function"==typeof e?n.local?ht:ct:n.local?lt:ut)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?dt:"function"==typeof e?gt:pt)(t,e,null==n?"":n)):mt(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?yt:"function"==typeof e?wt:vt)(t,e)):this.node()[t]},classed:function(t,e){var n=bt(t+"");if(arguments.length<2){for(var r=_t(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?Et:e?St:At)(n,e))},text:function(t){return arguments.length?this.each(null==t?Ct:("function"==typeof t?Tt:Nt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Dt:("function"==typeof t?Rt:zt)(t)):this.node().innerHTML},raise:function(){return this.each(Ot)},lower:function(){return this.each($t)},append:function(t){var e="function"==typeof t?t:I(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:I(t),r=null==e?Pt:"function"==typeof e?e:G(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Xt)},clone:function(t){return this.select(t?Ft:Bt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=Yt(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?It:qt,r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(r=0,u=s[l];r<a;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?jt:Gt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};function Kt(t){return"string"==typeof t?new Vt([[document.querySelector(t)]],[document.documentElement]):new Vt([[t]],Wt)}function Ut(t){return Kt(I(t).call(document.documentElement))}function Zt(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const Jt={capture:!0,passive:!1};function Qt(t){t.preventDefault(),t.stopImmediatePropagation()}function te(t){var e=t.document.documentElement,n=Kt(t).on("dragstart.drag",Qt,Jt);"onselectstart"in e?n.on("selectstart.drag",Qt,Jt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ee(t,e){var n=t.document.documentElement,r=Kt(t).on("dragstart.drag",null);e&&(r.on("click.drag",Qt,Jt),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function ne(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function re(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ie(){}var oe="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ae="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",se=/^#([0-9a-f]{3,8})$/,ue=new RegExp("^rgb\\("+["\\s*([+-]?\\d+)\\s*","\\s*([+-]?\\d+)\\s*","\\s*([+-]?\\d+)\\s*"]+"\\)$"),le=new RegExp("^rgb\\("+[ae,ae,ae]+"\\)$"),ce=new RegExp("^rgba\\("+["\\s*([+-]?\\d+)\\s*","\\s*([+-]?\\d+)\\s*","\\s*([+-]?\\d+)\\s*",oe]+"\\)$"),he=new RegExp("^rgba\\("+[ae,ae,ae,oe]+"\\)$"),fe=new RegExp("^hsl\\("+[oe,ae,ae]+"\\)$"),de=new RegExp("^hsla\\("+[oe,ae,ae,oe]+"\\)$"),pe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ge(){return this.rgb().formatHex()}function me(){return this.rgb().formatRgb()}function ye(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=se.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?ve(e):3===n?new xe(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?we(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?we(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ue.exec(t))?new xe(e[1],e[2],e[3],1):(e=le.exec(t))?new xe(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=ce.exec(t))?we(e[1],e[2],e[3],e[4]):(e=he.exec(t))?we(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=fe.exec(t))?Ae(e[1],e[2]/100,e[3]/100,1):(e=de.exec(t))?Ae(e[1],e[2]/100,e[3]/100,e[4]):pe.hasOwnProperty(t)?ve(pe[t]):"transparent"===t?new xe(NaN,NaN,NaN,0):null}function ve(t){return new xe(t>>16&255,t>>8&255,255&t,1)}function we(t,e,n,r){return r<=0&&(t=e=n=NaN),new xe(t,e,n,r)}function be(t){return t instanceof ie||(t=ye(t)),t?new xe((t=t.rgb()).r,t.g,t.b,t.opacity):new xe}function _e(t,e,n,r){return 1===arguments.length?be(t):new xe(t,e,n,null==r?1:r)}function xe(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function ke(){return"#"+Se(this.r)+Se(this.g)+Se(this.b)}function Me(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Se(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Ae(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ce(t,e,n,r)}function Ee(t){if(t instanceof Ce)return new Ce(t.h,t.s,t.l,t.opacity);if(t instanceof ie||(t=ye(t)),!t)return new Ce;if(t instanceof Ce)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Ce(a,s,u,t.opacity)}function Ce(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Ne(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Te(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}ne(ie,ye,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:ge,formatHex:ge,formatHsl:function(){return Ee(this).formatHsl()},formatRgb:me,toString:me}),ne(xe,_e,re(ie,{brighter:function(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new xe(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new xe(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ke,formatHex:ke,formatRgb:Me,toString:Me})),ne(Ce,(function(t,e,n,r){return 1===arguments.length?Ee(t):new Ce(t,e,n,null==r?1:r)}),re(ie,{brighter:function(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new Ce(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ce(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new xe(Ne(t>=240?t-240:t+120,i,r),Ne(t,i,r),Ne(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var De=t=>()=>t;function ze(t,e){return function(n){return t+n*e}}function Re(t){return 1==(t=+t)?Oe:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):De(isNaN(e)?n:e)}}function Oe(t,e){var n=e-t;return n?ze(t,n):De(isNaN(t)?e:t)}var $e=function t(e){var n=Re(e);function r(t,e){var r=n((t=_e(t)).r,(e=_e(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=Oe(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Pe(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=_e(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var Xe=Pe((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return Te((n-r/e)*e,a,i,o,s)}}));Pe((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return Te((n-r/e)*e,i,o,a,s)}}));function Be(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function Fe(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ye(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=Ve(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function qe(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Ie(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Le(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Ve(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var Ge=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,je=new RegExp(Ge.source,"g");function We(t,e){var n,r,i,o=Ge.lastIndex=je.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=Ge.exec(t))&&(r=je.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Ie(n,r)})),o=je.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function Ve(t,e){var n,r=typeof e;return null==e||"boolean"===r?De(e):("number"===r?Ie:"string"===r?(n=ye(e))?(e=n,$e):We:e instanceof ye?$e:e instanceof Date?qe:Fe(e)?Be:Array.isArray(e)?Ye:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Le:Ie)(t,e)}function He(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Ke(t){return((t=Math.exp(t))+1/t)/2}var Ue,Ze,Je=function t(e,n,r){function i(t,i){var o,a,s=t[0],u=t[1],l=t[2],c=i[0],h=i[1],f=i[2],d=c-s,p=h-u,g=d*d+p*p;if(g<1e-12)a=Math.log(f/l)/e,o=function(t){return[s+t*d,u+t*p,l*Math.exp(e*t*a)]};else{var m=Math.sqrt(g),y=(f*f-l*l+r*g)/(2*l*n*m),v=(f*f-l*l-r*g)/(2*f*n*m),w=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(v*v+1)-v);a=(b-w)/e,o=function(t){var r,i=t*a,o=Ke(w),c=l/(n*m)*(o*(r=e*i+w,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(w));return[s+c*d,u+c*p,l*o/Ke(e*i+w)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4),Qe=0,tn=0,en=0,nn=0,rn=0,on=0,an="object"==typeof performance&&performance.now?performance:Date,sn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function un(){return rn||(sn(ln),rn=an.now()+on)}function ln(){rn=0}function cn(){this._call=this._time=this._next=null}function hn(t,e,n){var r=new cn;return r.restart(t,e,n),r}function fn(){rn=(nn=an.now())+on,Qe=tn=0;try{!function(){un(),++Qe;for(var t,e=Ue;e;)(t=rn-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Qe}()}finally{Qe=0,function(){var t,e,n=Ue,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Ue=e);Ze=t,pn(r)}(),rn=0}}function dn(){var t=an.now(),e=t-nn;e>1e3&&(on-=e,nn=t)}function pn(t){Qe||(tn&&(tn=clearTimeout(tn)),t-rn>24?(t<1/0&&(tn=setTimeout(fn,t-an.now()-on)),en&&(en=clearInterval(en))):(en||(nn=an.now(),en=setInterval(dn,1e3)),Qe=1,sn(fn)))}cn.prototype=hn.prototype={constructor:cn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?un():+n)+(null==e?0:+e),this._next||Ze===this||(Ze?Ze._next=this:Ue=this,Ze=this),this._call=t,this._time=n,pn()},stop:function(){this._call&&(this._call=null,this._time=1/0,pn())}};X("start","end","cancel","interrupt");function gn(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}}var mn=t=>()=>t;function yn(t,{sourceEvent:e,target:n,selection:r,mode:i,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:i,enumerable:!0,configurable:!0},_:{value:o}})}function vn(t){t.stopImmediatePropagation()}function wn(t){t.preventDefault(),t.stopImmediatePropagation()}var bn={name:"drag"},_n={name:"space"},xn={name:"handle"},kn={name:"center"};const{abs:Mn,max:Sn,min:An}=Math;function En(t){return[+t[0],+t[1]]}function Cn(t){return[En(t[0]),En(t[1])]}var Nn={name:"x",handles:["w","e"].map(Pn),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Tn={name:"y",handles:["n","s"].map(Pn),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Dn=(["n","w","e","s","nw","ne","sw","se"].map(Pn),{overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"}),zn={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},Rn={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},On={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},$n={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function Pn(t){return{type:t}}function Xn(t){return!t.ctrlKey&&!t.button}function Bn(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Fn(){return navigator.maxTouchPoints||"ontouchstart"in this}function Yn(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function qn(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function In(t){var e,n=Bn,r=Xn,i=Fn,o=!0,a=X("start","brush","end"),s=6;function u(e){var n=e.property("__brush",g).selectAll(".overlay").data([Pn("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Dn.overlay).merge(n).each((function(){var t=Yn(this).extent;Kt(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),e.selectAll(".selection").data([Pn("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Dn.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=e.selectAll(".handle").data(t.handles,(function(t){return t.type}));r.exit().remove(),r.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return Dn[t.type]})),e.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(i).on("touchstart.brush",f).on("touchmove.brush",d).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function l(){var t=Kt(this),e=Yn(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?e[1][0]-s/2:e[0][0]-s/2})).attr("y",(function(t){return"s"===t.type[0]?e[1][1]-s/2:e[0][1]-s/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+s:s})).attr("height",(function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+s:s}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(t,e,n){var r=t.__brush.emitter;return!r||n&&r.clean?new h(t,e,n):r}function h(t,e,n){this.that=t,this.args=e,this.state=t.__brush,this.active=0,this.clean=n}function f(n){if((!e||n.touches)&&r.apply(this,arguments)){var i,a,s,u,h,f,d,p,g,m,y,v=this,w=n.target.__data__.type,b="selection"===(o&&n.metaKey?w="overlay":w)?bn:o&&n.altKey?kn:xn,_=t===Tn?null:On[w],x=t===Nn?null:$n[w],k=Yn(v),M=k.extent,S=k.selection,A=M[0][0],E=M[0][1],C=M[1][0],N=M[1][1],T=0,D=0,z=_&&x&&o&&n.shiftKey,R=Array.from(n.touches||[n],(t=>{const e=t.identifier;return(t=Zt(t,v)).point0=t.slice(),t.identifier=e,t}));gn(v);var O=c(v,arguments,!0).beforestart();if("overlay"===w){S&&(g=!0);const e=[R[0],R[1]||R[0]];k.selection=S=[[i=t===Tn?A:An(e[0][0],e[1][0]),s=t===Nn?E:An(e[0][1],e[1][1])],[h=t===Tn?C:Sn(e[0][0],e[1][0]),d=t===Nn?N:Sn(e[0][1],e[1][1])]],R.length>1&&F(n)}else i=S[0][0],s=S[0][1],h=S[1][0],d=S[1][1];a=i,u=s,f=h,p=d;var $=Kt(v).attr("pointer-events","none"),P=$.selectAll(".overlay").attr("cursor",Dn[w]);if(n.touches)O.moved=B,O.ended=Y;else{var X=Kt(n.view).on("mousemove.brush",B,!0).on("mouseup.brush",Y,!0);o&&X.on("keydown.brush",q,!0).on("keyup.brush",I,!0),te(n.view)}l.call(v),O.start(n,b.name)}function B(t){for(const e of t.changedTouches||[t])for(const t of R)t.identifier===e.identifier&&(t.cur=Zt(e,v));if(z&&!m&&!y&&1===R.length){const t=R[0];Mn(t.cur[0]-t[0])>Mn(t.cur[1]-t[1])?y=!0:m=!0}for(const t of R)t.cur&&(t[0]=t.cur[0],t[1]=t.cur[1]);g=!0,wn(t),F(t)}function F(t){const e=R[0],n=e.point0;var r;switch(T=e[0]-n[0],D=e[1]-n[1],b){case _n:case bn:_&&(T=Sn(A-i,An(C-h,T)),a=i+T,f=h+T),x&&(D=Sn(E-s,An(N-d,D)),u=s+D,p=d+D);break;case xn:R[1]?(_&&(a=Sn(A,An(C,R[0][0])),f=Sn(A,An(C,R[1][0])),_=1),x&&(u=Sn(E,An(N,R[0][1])),p=Sn(E,An(N,R[1][1])),x=1)):(_<0?(T=Sn(A-i,An(C-i,T)),a=i+T,f=h):_>0&&(T=Sn(A-h,An(C-h,T)),a=i,f=h+T),x<0?(D=Sn(E-s,An(N-s,D)),u=s+D,p=d):x>0&&(D=Sn(E-d,An(N-d,D)),u=s,p=d+D));break;case kn:_&&(a=Sn(A,An(C,i-T*_)),f=Sn(A,An(C,h+T*_))),x&&(u=Sn(E,An(N,s-D*x)),p=Sn(E,An(N,d+D*x)))}f<a&&(_*=-1,r=i,i=h,h=r,r=a,a=f,f=r,w in zn&&P.attr("cursor",Dn[w=zn[w]])),p<u&&(x*=-1,r=s,s=d,d=r,r=u,u=p,p=r,w in Rn&&P.attr("cursor",Dn[w=Rn[w]])),k.selection&&(S=k.selection),m&&(a=S[0][0],f=S[1][0]),y&&(u=S[0][1],p=S[1][1]),S[0][0]===a&&S[0][1]===u&&S[1][0]===f&&S[1][1]===p||(k.selection=[[a,u],[f,p]],l.call(v),O.brush(t,b.name))}function Y(t){if(vn(t),t.touches){if(t.touches.length)return;e&&clearTimeout(e),e=setTimeout((function(){e=null}),500)}else ee(t.view,g),X.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);$.attr("pointer-events","all"),P.attr("cursor",Dn.overlay),k.selection&&(S=k.selection),qn(S)&&(k.selection=null,l.call(v)),O.end(t,b.name)}function q(t){switch(t.keyCode){case 16:z=_&&x;break;case 18:b===xn&&(_&&(h=f-T*_,i=a+T*_),x&&(d=p-D*x,s=u+D*x),b=kn,F(t));break;case 32:b!==xn&&b!==kn||(_<0?h=f-T:_>0&&(i=a-T),x<0?d=p-D:x>0&&(s=u-D),b=_n,P.attr("cursor",Dn.selection),F(t));break;default:return}wn(t)}function I(t){switch(t.keyCode){case 16:z&&(m=y=z=!1,F(t));break;case 18:b===kn&&(_<0?h=f:_>0&&(i=a),x<0?d=p:x>0&&(s=u),b=xn,F(t));break;case 32:b===_n&&(t.altKey?(_&&(h=f-T*_,i=a+T*_),x&&(d=p-D*x,s=u+D*x),b=kn):(_<0?h=f:_>0&&(i=a),x<0?d=p:x>0&&(s=u),b=xn),P.attr("cursor",Dn[w]),F(t));break;default:return}wn(t)}}function d(t){c(this,arguments).moved(t)}function p(t){c(this,arguments).ended(t)}function g(){var e=this.__brush||{selection:null};return e.extent=Cn(n.apply(this,arguments)),e.dim=t,e}return u.move=function(e,n,r){e.tween?e.on("start.brush",(function(t){c(this,arguments).beforestart().start(t)})).on("interrupt.brush end.brush",(function(t){c(this,arguments).end(t)})).tween("brush",(function(){var e=this,r=e.__brush,i=c(e,arguments),o=r.selection,a=t.input("function"==typeof n?n.apply(this,arguments):n,r.extent),s=Ve(o,a);function u(t){r.selection=1===t&&null===a?null:s(t),l.call(e),i.brush()}return null!==o&&null!==a?u:u(1)})):e.each((function(){var e=this,i=arguments,o=e.__brush,a=t.input("function"==typeof n?n.apply(e,i):n,o.extent),s=c(e,i).beforestart();gn(e),o.selection=null===a?null:a,l.call(e),s.start(r).brush(r).end(r)}))},u.clear=function(t,e){u.move(t,null,e)},h.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(t,e){return this.starting?(this.starting=!1,this.emit("start",t,e)):this.emit("brush",t),this},brush:function(t,e){return this.emit("brush",t,e),this},end:function(t,e){return 0==--this.active&&(delete this.state.emitter,this.emit("end",t,e)),this},emit:function(e,n,r){var i=Kt(this.that).datum();a.call(e,this.that,new yn(e,{sourceEvent:n,target:u,selection:t.output(this.state.selection),mode:r,dispatch:a}),i)}},u.extent=function(t){return arguments.length?(n="function"==typeof t?t:mn(Cn(t)),u):n},u.filter=function(t){return arguments.length?(r="function"==typeof t?t:mn(!!t),u):r},u.touchable=function(t){return arguments.length?(i="function"==typeof t?t:mn(!!t),u):i},u.handleSize=function(t){return arguments.length?(s=+t,u):s},u.keyModifiers=function(t){return arguments.length?(o=!!t,u):o},u.on=function(){var t=a.on.apply(a,arguments);return t===a?u:t},u}function Ln(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const Gn=Symbol("implicit");function jn(){var t=new s,e=[],n=[],r=Gn;function i(i){let o=t.get(i);if(void 0===o){if(r!==Gn)return r;t.set(i,o=e.push(i)-1)}return n[o%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new s;for(const r of n)t.has(r)||t.set(r,e.push(r)-1);return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return jn(e,n).unknown(r)},Ln.apply(i,arguments),i}function Wn(){var t,e,n=jn().unknown(void 0),r=n.domain,i=n.range,o=0,a=1,s=!1,u=0,l=0,c=.5;function h(){var n=r().length,h=a<o,f=h?a:o,d=h?o:a;t=(d-f)/Math.max(1,n-u+2*l),s&&(t=Math.floor(t)),f+=(d-f-t*(n-u))*c,e=t*(1-u),s&&(f=Math.round(f),e=Math.round(e));var p=y(n).map((function(e){return f+t*e}));return i(h?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),h()):r()},n.range=function(t){return arguments.length?([o,a]=t,o=+o,a=+a,h()):[o,a]},n.rangeRound=function(t){return[o,a]=t,o=+o,a=+a,s=!0,h()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(s=!!t,h()):s},n.padding=function(t){return arguments.length?(u=Math.min(1,l=+t),h()):u},n.paddingInner=function(t){return arguments.length?(u=Math.min(1,t),h()):u},n.paddingOuter=function(t){return arguments.length?(l=+t,h()):l},n.align=function(t){return arguments.length?(c=Math.max(0,Math.min(1,t)),h()):c},n.copy=function(){return Wn(r(),[o,a]).round(s).paddingInner(u).paddingOuter(l).align(c)},Ln.apply(h(),arguments)}function Vn(t){return+t}var Hn=[0,1];function Kn(t){return t}function Un(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Zn(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Un(i,r),o=n(a,o)):(r=Un(r,i),o=n(o,a)),function(t){return o(r(t))}}function Jn(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)i[s]=Un(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(e){var n=a(t,e,1,r)-1;return o[n](i[n](e))}}function Qn(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function tr(){var t,e,n,r,i,o,a=Hn,s=Hn,u=Ve,l=Kn;function c(){var t,e,n,u=Math.min(a.length,s.length);return l!==Kn&&(t=a[0],e=a[u-1],t>e&&(n=t,t=e,e=n),l=function(n){return Math.max(t,Math.min(e,n))}),r=u>2?Jn:Zn,i=o=null,h}function h(e){return null==e||isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return h.invert=function(n){return l(e((o||(o=r(s,a.map(t),Ie)))(n)))},h.domain=function(t){return arguments.length?(a=Array.from(t,Vn),c()):a.slice()},h.range=function(t){return arguments.length?(s=Array.from(t),c()):s.slice()},h.rangeRound=function(t){return s=Array.from(t),u=He,c()},h.clamp=function(t){return arguments.length?(l=!!t||Kn,c()):l!==Kn},h.interpolate=function(t){return arguments.length?(u=t,c()):u},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,c()}}function er(){return tr()(Kn,Kn)}function nr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function rr(t){return(t=nr(Math.abs(t)))?t[1]:NaN}var ir,or=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ar(t){if(!(e=or.exec(t)))throw new Error("invalid format: "+t);var e;return new sr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function sr(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function ur(t,e){var n=nr(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}ar.prototype=sr.prototype,sr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var lr={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>ur(100*t,e),r:ur,s:function(t,e){var n=nr(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(ir=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+nr(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function cr(t){return t}var hr,fr,dr,pr=Array.prototype.map,gr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function mr(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?cr:(e=pr.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?cr:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(pr.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"−":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=ar(t)).fill,n=t.align,h=t.sign,f=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,y=t.trim,v=t.type;"n"===v?(g=!0,v="g"):lr[v]||(void 0===m&&(m=12),y=!0,v="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var w="$"===f?i:"#"===f&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",b="$"===f?o:/[%p]/.test(v)?u:"",_=lr[v],x=/[defgprs%]/.test(v);function k(t){var i,o,u,f=w,k=b;if("c"===v)k=_(t)+k,t="";else{var M=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:_(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),M&&0==+t&&"+"!==h&&(M=!1),f=(M?"("===h?h:l:"-"===h||"("===h?"":h)+f,k=("s"===v?gr[8+ir/3]:"")+k+(M&&"("===h?")":""),x)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){k=(46===u?a+t.slice(i+1):t.slice(i))+k,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var S=f.length+t.length+k.length,A=S<p?new Array(p-S+1).join(e):"";switch(g&&d&&(t=r(A+t,A.length?p-k.length:1/0),A=""),n){case"<":t=f+t+k+A;break;case"=":t=f+A+t+k;break;case"^":t=A.slice(0,S=A.length>>1)+f+t+k+A.slice(S);break;default:t=A+f+t+k}return s(t)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return t+""},k}return{format:h,formatPrefix:function(t,e){var n=h(((t=ar(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(rr(e)/3))),i=Math.pow(10,-r),o=gr[8+r/3];return function(t){return n(i*t)+o}}}}function yr(t,e,n,r){var i,o=function(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=w?i*=10:o>=b?i*=5:o>=_&&(i*=2),e<t?-i:i}(t,e,n);switch((r=ar(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(rr(e)/3)))-rr(Math.abs(t)))}(o,a))||(r.precision=i),dr(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,rr(e)-rr(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-rr(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return fr(r)}function vr(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=x(t,e,n))||!isFinite(a))return[];if(a>0){let n=Math.round(t/a),r=Math.round(e/a);for(n*a<t&&++n,r*a>e&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)*a}else{a=-a;let n=Math.round(t*a),r=Math.round(e*a);for(n/a<t&&++n,r/a>e&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)/a}return r&&o.reverse(),o}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return yr(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),a=0,s=o.length-1,u=o[a],l=o[s],c=10;for(l<u&&(i=u,u=l,l=i,i=a,a=s,s=i);c-- >0;){if((i=x(u,l,n))===r)return o[a]=u,o[s]=l,e(o);if(i>0)u=Math.floor(u/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,l=Math.floor(l*i)/i}r=i}return t},t}function wr(){var t=er();return t.copy=function(){return Qn(t,wr())},Ln.apply(t,arguments),vr(t)}function br(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}hr=mr({thousands:",",grouping:[3],currency:["$",""]}),fr=hr.format,dr=hr.formatPrefix;var _r=t=>Xe(t[t.length-1]),xr=_r(new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(br)),kr=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(br);_r(kr);const Mr=Math.PI,Sr=2*Mr,Ar=Sr-1e-6;function Er(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Cr(){return new Er}Er.prototype=Cr.prototype={constructor:Er,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var o=this._x1,a=this._y1,s=n-t,u=r-e,l=o-t,c=a-e,h=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>1e-6)if(Math.abs(c*s-u*l)>1e-6&&i){var f=n-o,d=r-a,p=s*s+u*u,g=f*f+d*d,m=Math.sqrt(p),y=Math.sqrt(h),v=i*Math.tan((Mr-Math.acos((p+h-g)/(2*m*y)))/2),w=v/y,b=v/m;Math.abs(w-1)>1e-6&&(this._+="L"+(t+w*l)+","+(e+w*c)),this._+="A"+i+","+i+",0,0,"+ +(c*f>l*d)+","+(this._x1=t+b*s)+","+(this._y1=e+b*u)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,i,o){t=+t,e=+e,o=!!o;var a=(n=+n)*Math.cos(r),s=n*Math.sin(r),u=t+a,l=e+s,c=1^o,h=o?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+l:(Math.abs(this._x1-u)>1e-6||Math.abs(this._y1-l)>1e-6)&&(this._+="L"+u+","+l),n&&(h<0&&(h=h%Sr+Sr),h>Ar?this._+="A"+n+","+n+",0,1,"+c+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=Mr)+","+c+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Nr=Cr;Array.prototype.slice;function Tr(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Dr(t){return function(){return t}}function zr(t){this._context=t}function Rr(t){return new zr(t)}function Or(t){return t[0]}function $r(t){return t[1]}function Pr(t,e,n){var r=null,i=Dr(!0),o=null,a=Rr,s=null;function u(u){var l,c,h,f,d,p=(u=Tr(u)).length,g=!1,m=new Array(p),y=new Array(p);for(null==o&&(s=a(d=Nr())),l=0;l<=p;++l){if(!(l<p&&i(f=u[l],l,u))===g)if(g=!g)c=l,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=l-1;h>=c;--h)s.point(m[h],y[h]);s.lineEnd(),s.areaEnd()}g&&(m[l]=+t(f,l,u),y[l]=+e(f,l,u),s.point(r?+r(f,l,u):m[l],n?+n(f,l,u):y[l]))}if(d)return s=null,d+""||null}function l(){return function(t,e){var n=Dr(!0),r=null,i=Rr,o=null;function a(a){var s,u,l,c=(a=Tr(a)).length,h=!1;for(null==r&&(o=i(l=Nr())),s=0;s<=c;++s)!(s<c&&n(u=a[s],s,a))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+t(u,s,a),+e(u,s,a));if(l)return o=null,l+""||null}return t="function"==typeof t?t:void 0===t?Or:Dr(t),e="function"==typeof e?e:void 0===e?$r:Dr(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:Dr(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:Dr(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:Dr(!!t),a):n},a.curve=function(t){return arguments.length?(i=t,null!=r&&(o=i(r)),a):i},a.context=function(t){return arguments.length?(null==t?r=o=null:o=i(r=t),a):r},a}().defined(i).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?Or:Dr(+t),e="function"==typeof e?e:Dr(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?$r:Dr(+n),u.x=function(e){return arguments.length?(t="function"==typeof e?e:Dr(+e),r=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:Dr(+e),u):t},u.x1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Dr(+t),u):r},u.y=function(t){return arguments.length?(e="function"==typeof t?t:Dr(+t),n=null,u):e},u.y0=function(t){return arguments.length?(e="function"==typeof t?t:Dr(+t),u):e},u.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:Dr(+t),u):n},u.lineX0=u.lineY0=function(){return l().x(t).y(e)},u.lineY1=function(){return l().x(t).y(n)},u.lineX1=function(){return l().x(r).y(e)},u.defined=function(t){return arguments.length?(i="function"==typeof t?t:Dr(!!t),u):i},u.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),u):a},u.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),u):o},u}function Xr(t,e){if((i=t.length)>1)for(var n,r,i,o=1,a=t[e[0]],s=a.length;o<i;++o)for(r=a,a=t[e[o]],n=0;n<s;++n)a[n][1]+=a[n][0]=isNaN(r[n][1])?r[n][0]:r[n][1]}function Br(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function Fr(t,e){return t[e]}function Yr(t){const e=[];return e.key=t,e}zr.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var qr=t=>()=>t;function Ir(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Lr(t,e,n){this.k=t,this.x=e,this.y=n}Lr.prototype={constructor:Lr,scale:function(t){return 1===t?this:new Lr(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Lr(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Gr=new Lr(1,0,0);function jr(t){t.stopImmediatePropagation()}function Wr(t){t.preventDefault(),t.stopImmediatePropagation()}function Vr(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Hr(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Kr(){return this.__zoom||Gr}function Ur(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Zr(){return navigator.maxTouchPoints||"ontouchstart"in this}function Jr(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}Lr.prototype;var Qr,ti,ei,ni,ri={};
/*! @license https://github.com/onury/invert-color */Qr=ri,ti=function(){var t=Math.sqrt(1.05*.05)-.05,e=/^(?:[0-9a-f]{3}){1,2}$/i,n={black:"#000000",white:"#ffffff",threshold:t};function r(t){if("#"===t.slice(0,1)&&(t=t.slice(1)),!e.test(t))throw new Error('Invalid HEX color: "'+t+'"');return 3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function i(t){if(!t)throw new Error("Invalid color value");return Array.isArray(t)?t:"string"==typeof t?r(t):[t.r,t.g,t.b]}function o(t,e,i){var o=!0===e?n:Object.assign({},n,e);return function(t){var e,n,r=[];for(e=0;e<t.length;e++)n=t[e]/255,r[e]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4);return.2126*r[0]+.7152*r[1]+.0722*r[2]}(t)>o.threshold?i?r(o.black):o.black:i?r(o.white):o.white}function a(t,e){return void 0===e&&(e=!1),t=i(t),e?o(t,e):"#"+t.map((function(t){var e,n;return e=(255-t).toString(16),void 0===n&&(n=2),(new Array(n).join("0")+e).slice(-n)})).join("")}return function(e){function n(t,e){var n;return t=i(t),{r:(n=e?o(t,e,!0):t.map((function(t){return 255-t})))[0],g:n[1],b:n[2]}}e.asRGB=n,e.asRgbArray=function(t,e){return t=i(t),e?o(t,e,!0):t.map((function(t){return 255-t}))},e.defaultThreshold=t,e.asRgbObject=n}(a||(a={})),a},"object"==typeof ri?ri=ti():"function"==typeof define&&define.amd?define(ti):Qr.invert=ti();(ni=ei||(ei={}))[ni.Normal=0]="Normal",ni[ni.Hidden=1]="Hidden",ni[ni.Highlight=2]="Highlight",ni[ni.Translucent=3]="Translucent";class ii{constructor(){}use(t){return this.opt=t,this}node(){return`${this.opt.src} -> ${this.opt.dst}<br>Weight: ${this.opt.weight}<br>Detail: ${this.opt.detail}`}}class oi extends class{constructor(){}}{constructor(){super(),this.mapRatio=13,this.paddingX=this.paddingY=10,this.edgeWidth=6.2,this.nodeSize=40,this.labelPadding=4,this.dualEdgeSpace=this.edgeWidth+.4}}class ai extends class{constructor(t){this.div=t}refresh(t){this.render(t)}remove(){Kt(this.div).selectAll("*").remove()}}{constructor(t){super(t),this.config=new oi;const e=this.config;let n;Kt(this.div).selectAll("svg").remove(),Kt(this.div).selectAll("div").remove(),this.tooltipNode=Kt(this.div).append("div").attr("class","node-tooltip").style("opacity",.85),this.tooltipEdge=Kt(this.div).append("div").attr("class","edge-tooltip").style("opacity",.85),this.svg=Kt(this.div).append("svg").attr("transform","scale(0.6)"),this.g=this.svg.append("g");const r=function(){var t,e,n,r=Vr,i=Hr,o=Jr,a=Ur,s=Zr,u=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],c=250,h=Je,f=X("start","zoom","end"),d=500,p=0,g=10;function m(t){t.property("__zoom",Kr).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",S).filter(s).on("touchstart.zoom",A).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",C).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new Lr(e,t.x,t.y)}function v(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new Lr(t.k,r,i)}function w(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function b(t,e,n,r){t.on("start.zoom",(function(){_(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){_(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,o=arguments,a=_(t,o).event(r),s=i.apply(t,o),u=null==n?w(s):"function"==typeof n?n.apply(t,o):n,l=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),c=t.__zoom,f="function"==typeof e?e.apply(t,o):e,d=h(c.invert(u).concat(l/c.k),f.invert(u).concat(l/f.k));return function(t){if(1===t)t=f;else{var e=d(t),n=l/e[2];t=new Lr(n,u[0]-e[0]*n,u[1]-e[1]*n)}a.zoom(null,t)}}))}function _(t,e,n){return!n&&t.__zooming||new x(t,e)}function x(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function k(t,...e){if(r.apply(this,arguments)){var n=_(this,e).event(t),i=this.__zoom,s=Math.max(u[0],Math.min(u[1],i.k*Math.pow(2,a.apply(this,arguments)))),c=Zt(t);if(n.wheel)n.mouse[0][0]===c[0]&&n.mouse[0][1]===c[1]||(n.mouse[1]=i.invert(n.mouse[0]=c)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[c,i.invert(c)],gn(this),n.start()}Wr(t),n.wheel=setTimeout(h,150),n.zoom("mouse",o(v(y(i,s),n.mouse[0],n.mouse[1]),n.extent,l))}function h(){n.wheel=null,n.end()}}function M(t,...e){if(!n&&r.apply(this,arguments)){var i=t.currentTarget,a=_(this,e,!0).event(t),s=Kt(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",d,!0),u=Zt(t,i),c=t.clientX,h=t.clientY;te(t.view),jr(t),a.mouse=[u,this.__zoom.invert(u)],gn(this),a.start()}function f(t){if(Wr(t),!a.moved){var e=t.clientX-c,n=t.clientY-h;a.moved=e*e+n*n>p}a.event(t).zoom("mouse",o(v(a.that.__zoom,a.mouse[0]=Zt(t,i),a.mouse[1]),a.extent,l))}function d(t){s.on("mousemove.zoom mouseup.zoom",null),ee(t.view,a.moved),Wr(t),a.event(t).end()}}function S(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,a=Zt(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),u=n.k*(t.shiftKey?.5:2),h=o(v(y(n,u),a,s),i.apply(this,e),l);Wr(t),c>0?Kt(this).transition().duration(c).call(b,h,a,t):Kt(this).call(m.transform,h,a,t)}}function A(n,...i){if(r.apply(this,arguments)){var o,a,s,u,l=n.touches,c=l.length,h=_(this,i,n.changedTouches.length===c).event(n);for(jr(n),a=0;a<c;++a)u=[u=Zt(s=l[a],this),this.__zoom.invert(u),s.identifier],h.touch0?h.touch1||h.touch0[2]===u[2]||(h.touch1=u,h.taps=0):(h.touch0=u,o=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(h.taps<2&&(e=u[0],t=setTimeout((function(){t=null}),d)),gn(this),h.start())}}function E(t,...e){if(this.__zooming){var n,r,i,a,s=_(this,e).event(t),u=t.changedTouches,c=u.length;for(Wr(t),n=0;n<c;++n)i=Zt(r=u[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var h=s.touch0[0],f=s.touch0[1],d=s.touch1[0],p=s.touch1[1],g=(g=d[0]-h[0])*g+(g=d[1]-h[1])*g,m=(m=p[0]-f[0])*m+(m=p[1]-f[1])*m;r=y(r,Math.sqrt(g/m)),i=[(h[0]+d[0])/2,(h[1]+d[1])/2],a=[(f[0]+p[0])/2,(f[1]+p[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(v(r,i,a),s.extent,l))}}function C(t,...r){if(this.__zooming){var i,o,a=_(this,r).event(t),s=t.changedTouches,u=s.length;for(jr(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),d),i=0;i<u;++i)o=s[i],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=Zt(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<g)){var l=Kt(this).on("dblclick.zoom");l&&l.apply(this,arguments)}}}return m.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",Kr),t!==i?b(t,e,n,r):i.interrupt().each((function(){_(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,r){m.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},m.scaleTo=function(t,e,n,r){m.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,a=null==n?w(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),u="function"==typeof e?e.apply(this,arguments):e;return o(v(y(r,u),a,s),t,l)}),n,r)},m.translateBy=function(t,e,n,r){m.transform(t,(function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),l)}),null,r)},m.translateTo=function(t,e,n,r,a){m.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,s=null==r?w(t):"function"==typeof r?r.apply(this,arguments):r;return o(Gr.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,l)}),r,a)},x.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Kt(this.that).datum();f.call(t,this.that,new Ir(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:f}),e)}},m.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:qr(+t),m):a},m.filter=function(t){return arguments.length?(r="function"==typeof t?t:qr(!!t),m):r},m.touchable=function(t){return arguments.length?(s="function"==typeof t?t:qr(!!t),m):s},m.extent=function(t){return arguments.length?(i="function"==typeof t?t:qr([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):i},m.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],m):[u[0],u[1]]},m.translateExtent=function(t){return arguments.length?(l[0][0]=+t[0][0],l[1][0]=+t[1][0],l[0][1]=+t[0][1],l[1][1]=+t[1][1],m):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},m.constrain=function(t){return arguments.length?(o=t,m):o},m.duration=function(t){return arguments.length?(c=+t,m):c},m.interpolate=function(t){return arguments.length?(h=t,m):h},m.on=function(){var t=f.on.apply(f,arguments);return t===f?m:t},m.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,m):Math.sqrt(p)},m.tapDistance=function(t){return arguments.length?(g=+t,m):g},m}().scaleExtent([.1,20]).on("zoom",(t=>{this.g.attr("transform",n=t.transform),this.g.style("stroke-width",3/Math.sqrt(n.k))}));this.svg.call(r),this.g.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",e.nodeSize/2+e.edgeWidth).attr("refY",0).attr("markerWidth",e.edgeWidth/3.5).attr("markerHeight",e.edgeWidth/3.5).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5")}colorScheme(t){let e=0;return null!=t&&(e=t),xr((9-e)/9)}render(e){let n=this.colorScheme,r=this.tooltipNode,i=this.tooltipEdge,o=e.meta.width,a=e.meta.height;const s=this.config,u=o*(s.nodeSize+s.edgeWidth),l=a*(s.nodeSize+s.edgeWidth);let c=t=>{let n={X:0,Y:0};return e.nodes.some((e=>{if(e.id===t)return n.X=Number(t)%o*s.mapRatio*10+s.paddingX,n.Y=Math.floor(Number(t)/a)*s.mapRatio*10+s.paddingY,!0})),n},h=t=>{let e=Number(t)%o;return`[${Math.floor(Number(t)/a)}, ${e}]`};this.svg.attr("viewBox",`0 0 ${u}, ${l}`),this.g.selectAll("line").data(e.edges).join((function(t){return t.append("line").attr("marker-end","url(#end)")}),(function(t){return t}),(function(t){return t.on("end",(function(){Kt(this).remove()}))})).attr("x1",(function(t){let e=c(t.source),n=c(t.target);return e.X==n.X?e.Y<n.Y?e.X+s.dualEdgeSpace:e.X-s.dualEdgeSpace:e.X})).attr("x2",(function(t){let e=c(t.source),n=c(t.target);return e.X==n.X?e.Y<n.Y?n.X+s.dualEdgeSpace:n.X-s.dualEdgeSpace:n.X})).attr("y1",(function(t){let e=c(t.source),n=c(t.target);return e.Y==n.Y?e.X<n.X?e.Y-s.dualEdgeSpace:e.Y+s.dualEdgeSpace:e.Y})).attr("y2",(function(t){let e=c(t.source),n=c(t.target);return e.Y==n.Y?e.X<n.X?n.Y-s.dualEdgeSpace:n.Y+s.dualEdgeSpace:n.Y})).attr("stroke-dasharray",(function(t){let e=c(t.source),n=c(t.target);return e.X<n.X||e.Y<n.Y?"5,0":"2,1"})).attr("stroke-width",(function(t){return s.edgeWidth})).attr("opacity",(function(t){return t.style===ei.Translucent?.02:t.style===ei.Hidden?0:1})).on("mouseover",(function(e,r){Kt(this).attr("stroke-width",1.8*s.edgeWidth);let o=n(r.weight);return i.style("visibility","visible").style("background-color",o).style("color",t(ri)(function(t){let e=t.replace(/[^\d,]/g,"").split(",");return"#"+(16777216+(+e[0]<<16)+(+e[1]<<8)+ +e[2]).toString(16).slice(1)}(o),{black:"#3a3a3a",white:"#fafafa"})).html((new ii).use({src:h(r.source),dst:h(r.target),weight:r.weight?.toString(),detail:r.detail}).node())})).on("mousemove",(function(t,e){return i.style("top",t.pageY+1+"px").style("left",t.pageX+1+"px")})).on("mouseout",(function(t,e){return Kt(this).attr("stroke-width",s.edgeWidth),i.style("visibility","hidden")})).attr("stroke",(function(t){return n(t.weight)})),this.g.selectAll("rect").data(e.nodes).join((function(t){return t.append("rect").attr("width",s.nodeSize).attr("height",s.nodeSize).attr("rx",1.5).attr("ry",1.5).attr("stroke","#599dbb").attr("stroke-width","0.18em").attr("fill","#8fbed1")}),(function(t){return t}),(function(t){return t.on("end",(function(){Kt(this).remove()}))})).attr("x",(function(t){return c(t.id).X-s.nodeSize/2})).attr("y",(function(t){return c(t.id).Y-s.nodeSize/2})).on("mouseover",(function(t,e){return Kt(this).attr("fill","#599dbb"),r.style("visibility","visible").html(`ID in Grid: ${e.id}<br>Coord: ${h(e.id)}<br>Detail: ${e.detail}`)})).on("mousemove",(function(t,e){return r.style("top",t.pageY+1+"px").style("left",t.pageX+1+"px")})).on("mouseout",(function(t,e){return Kt(this).attr("fill","#8fbed1"),r.style("visibility","hidden")})),this.g.selectAll(".node-label").data(e.nodes).join((function(t){return t.append("text").attr("class","node-label").attr("dominant-baseline","middle")}),(function(t){return t}),(function(t){return t.on("end",(function(){Kt(this).remove()}))})).attr("x",(function(t){return c(t.id).X})).attr("y",(function(t){return c(t.id).Y+.8*s.nodeSize})).transition().text((function(t){return void 0===t.label?"":t.label}));this.g.selectAll(".edge-label").data(e.edges).join((function(t){return t.append("text").attr("class","edge-label").attr("dy",".35em").attr("dominant-baseline","middle")}),(function(t){return t}),(function(t){return t.on("end",(function(){Kt(this).remove()}))})).attr("x",(function(t){return(t=>{let e=c(t.source),n=c(t.target);return e.X==n.X?e.Y<n.Y?e.X+s.dualEdgeSpace+s.edgeWidth+2*s.labelPadding:e.X-s.dualEdgeSpace-s.edgeWidth-2*s.labelPadding:(e.X+n.X)/2})(t)})).attr("y",(function(t){return(t=>{let e=c(t.source),n=c(t.target);return e.Y==n.Y?e.X<n.X?e.Y-s.dualEdgeSpace-s.edgeWidth-2*s.labelPadding:e.Y+s.dualEdgeSpace+s.edgeWidth+.75*s.labelPadding:(e.Y+n.Y)/2})(t)})).transition().text((function(t){return void 0===t.label?"":t.label}))}}class si{constructor(t,e){this.layout=new e(t)}renderData(t){this.layout.render(t)}clear(){this.layout.remove()}}const ui=["Translation","Read","Write","Others"],li=ui.length,ci={"*cache.FlushReq":"Others","*cache.FlushRsp":"Others","*mem.DataReadyRsp":"Read","*mem.ReadReq":"Read","*mem.WriteDoneRsp":"Write","*mem.WriteReq":"Write","*protocol.FlushReq":"Others","*protocol.LaunchKernelReq":"Others","*protocol.MapWGReq":"Others","*protocol.WGCompletionMsg":"Others","*vm.TranslationReq":"Translation","*vm.TranslationRsp":"Translation"};Object.keys(ci).length;function hi(t){const e={};return Object.keys(t).forEach((n=>{e[t[n]]?e[t[n]].push(n):e[t[n]]=[n]})),e}const fi=hi(ci),di=["D","C"],pi=(di.length,hi({"*cache.FlushReq":"C","*cache.FlushRsp":"C","*mem.DataReadyRsp":"D","*mem.ReadReq":"C","*mem.WriteDoneRsp":"C","*mem.WriteReq":"D","*protocol.FlushReq":"C","*protocol.LaunchKernelReq":"C","*protocol.MapWGReq":"C","*protocol.WGCompletionMsg":"C","*vm.TranslationReq":"C","*vm.TranslationRsp":"D"}));var gi,mi,yi,vi;(mi=gi||(gi={}))[mi.ByMsgGroup=0]="ByMsgGroup",mi[mi.ByDataOrCommand=1]="ByDataOrCommand";class wi{constructor(t){this.signal={},this.groupDomain=ui,this.docDomain=di,this.filterType=gi.ByMsgGroup,t.AppendForMsgGroup((t=>this.updateMsgGroupDomain(t))),t.AppendForDataOrCommand((t=>this.updateDataOrCommandDomain(t))),this.initSignalCallbacks()}initSignalCallbacks(){this.signal.msg=t=>{"group"===t?this.filterType=gi.ByMsgGroup:"doc"===t?this.filterType=gi.ByDataOrCommand:console.error("Invalid message signal for module filter")}}decorateData(t,e){e.edges.forEach(((e,n)=>{e.source=t.edges[n].source,e.target=t.edges[n].target,e.detail=t.edges[n].detail,e.weight=0,this.filterType==gi.ByMsgGroup?this.groupDomain.forEach((r=>{fi[r].forEach((r=>{const i=t.edges[n].value[r];i>0&&(e.detail+=`<br>${r}: ${i}`,e.weight+=t.edges[n].value[r])}))})):this.filterType==gi.ByDataOrCommand&&this.docDomain.forEach((r=>{pi[r].forEach((r=>{const i=t.edges[n].value[r];i>0&&(e.detail+=`<br>${r}: ${i}`,e.weight+=t.edges[n].value[r])}))})),e.label=0===e.weight?"":`${e.weight}`}))}invokeController(){}updateMsgGroupDomain(t){this.groupDomain=t}updateDataOrCommandDomain(t){this.docDomain=t}}class bi{constructor(){this.signal={}}decorateData(t){let e=0;t.edges.forEach((t=>{e<t.weight&&(e=t.weight)})),t.edges.forEach((t=>{0!=e&&(t.weight=Math.round(9*t.weight/e))}))}invokeController(){}}class _i{constructor(){this.speed=1,this.step=1}updateSpeed(t){return this.speed<=0?console.error(`InnerTicker speed cannot be set to a non-positive number like ${t}`):this.speed=t,this}updateStep(t){return this.step=t,this}next(t){return t+this.step}auto(){!0===this.tickFunc()?this.timeoutHandle=setTimeout((()=>this.auto()),1e3/this.speed):console.log("Automatic tick finished in InnerTicker")}pause(){clearTimeout(this.timeoutHandle)}manual(){this.tickFunc()}still(){let t=this.step;this.step=0,this.tickFunc(),this.step=t}}(vi=yi||(yi={}))[vi.SliceTick=0]="SliceTick",vi[vi.RangeTick=1]="RangeTick";class xi{constructor(t){this.signal={},this.t=new _i,this.mode=yi.SliceTick,this.cast=()=>{},this.running=!1,this.statusChangeCallback=()=>{},this.maxTime=t,this.initSignalCallbacks()}initSignalCallbacks(){this.signal.speed=t=>{this.t.updateSpeed(Number(t))},this.signal.step=t=>{this.t.updateStep(Number(t))},this.signal.state=t=>{let e=t,n=this.running;"auto"===e?(this.t.auto(),n=!0):"pause"===e?(this.t.pause(),n=!1):"manual"===e?(this.t.manual(),n=!1):"still"===e?(this.t.still(),n=!1):console.error(`Unknown state signal ${e} passed to Ticker`),n!=this.running&&(console.log(`change from ${this.running} -> ${n}`),this.running=n,this.statusChangeCallback(this.running))},this.signal.mode=t=>{this.t.pause();let e=t;"slice"===e?this.mode=yi.SliceTick:"range"===e?this.mode=yi.RangeTick:console.error(`Unknown mode signal ${e} passed to Ticker`)}}setCast(t){return this.cast=t,this}bindController(t){return this.t.tickFunc=()=>(this.mode===yi.SliceTick?0!=this.t.next(0)&&(t.startTime=t.endTime):(this.mode,yi.RangeTick),t.endTime===this.maxTime?(this.running=!1,this.statusChangeCallback(!1),!1):(t.endTime=this.t.next(t.endTime),this.cast(t.startTime,t.endTime),t.requestDataPort(),!0)),this}setStatusChangeCallback(t){return this.statusChangeCallback=t,this}}class ki{constructor(t){this.heartBeat=()=>{this.ws.send("pong"),setTimeout((()=>this.heartBeat()),5e3)},this.notifyFree=()=>{this.pending=!1},this.currentHandler=()=>this.handleMsg,this.pending=!0,this.ws=new WebSocket(t);const e=this.currentHandler,n=this.notifyFree,r=this.heartBeat;this.ws.onopen=function(){console.log("WebSocket connection established"),n(),r()},this.ws.onmessage=function(t){console.log("WebSocket received"),e()(t.data),n()},this.ws.onclose=function(t){t.wasClean?console.log(`WebSocket connection closed cleanly, code=${t.code}, reason=${t.reason}`):console.log("WebSocket connection died")},this.ws.onerror=function(t){console.error(`WebSocket error observed: ${t}`)}}send(t,e){this.pending?setTimeout((()=>this.send(t,e)),500):(this.pending=!0,this.handleMsg=e,this.ws.send(t))}isClosed(){return this.ws.readyState==WebSocket.CLOSED}}class Mi{constructor(t,e){this.div=Ut("div"),void 0===t?this.id="_"+Math.random().toString(36).substr(2,9):(this.div.attr("id",t),this.id=t),null!=e&&("string"==typeof e.height&&this.div.attr("height",e.height),"string"==typeof e.width&&this.div.attr("width",e.width))}node(){return this.div.node()}}class Si extends Mi{constructor(t,e){super(t,e),this.updateButton=(t,e)=>{let n=this.div.select("button");n.html(void 0===t.html?t.name:t.html),"string"==typeof t.color&&n.attr("class",`btn btn-sm ${t.color}`),n.attr("flip-status",`${e}`)},this.div.style("margin","0.25em"),this.flip=new Array;let n=`${this.id}-flip-btn`;this.btn=this.div.append("button").attr("type","button").attr("class","btn btn-sm btn-primary").attr("id",n).attr("flip-status","0")}append(t){return this.flip=[...this.flip,...t],this.updateButton(this.flip[0],0),this.event((()=>{})),this}event(t){const e=this.flip,n=this.updateButton;return this.div.select("button").on("click",(function(){const r=Number(Kt(this).attr("flip-status")),i=e[r].name,o=(r+1)%e.length;console.log(i),t(i),n(e[o],o)})),this}display(t){let e=!1;return this.flip.some(((n,r)=>{if(n.name===t)return this.updateButton(n,r),e=!0,!0})),e}static(t){return this.display(t),this}switch(t){return!0===this.display(t)&&this.div.select("button").dispatch("click"),this}}class Ai extends Mi{constructor(t){super(t),this.div.attr("class","form-floating").style("margin","0.25rem")}append(t){let e=`${this.id}-input`,n=this.div.append("input").attr("class","form-control").attr("id",e);return"string"==typeof t.placeholder&&n.property("value",t.placeholder),this.div.append("label").attr("for",e).text(t.label),this}event(t){return this.div.select("input").on("change",(function(){const e=this.value;t(e)})),this}deactivate(){return this.div.select("input").attr("disabled","true"),this}activate(){return this.div.select("input").attr("disabled",null),this}updateValueNotDispatchEvent(t){return this.div.select("input").property("value",t),this}}class Ei extends Mi{constructor(t){super(t),this.div.style("margin","0.5em")}append(t){return t.forEach((t=>{this.div.append("label").style("display","block").style("margin","0.25em").text(t.label),void 0===t.widgets?console.warn("append empty LabelBox"):t.widgets.forEach((t=>{this.div.append((()=>t.node()))}))})),this}}class Ci extends Mi{constructor(t){super(t),this.numButtons=0,this.items=new Array,this.div.attr("class","btn-group").attr("role","group").attr("aria-label","Radio toggle button group").style("margin","0.25em")}radioID(t){return`${this.id}-btnradio${t}`}append(t){return this.items=[...this.items,...t],t.forEach((t=>{let e=this.radioID(this.numButtons);this.div.append("input").attr("type","radio").attr("class","btn-check").attr("name",`${this.id}-btnradio`).attr("id",e).attr("autocomplete","off");this.div.append("label").attr("class","btn btn-outline-primary").attr("for",e).text(t),this.numButtons+=1})),this}event(t){return this.div.selectAll("input").on("change",(function(){let e;!0===this.checked&&(e=this.nextElementSibling.textContent,t(e))})),this}switch(t){return this.items.some(((e,n)=>{if(e===t){let t=this.radioID(n);return this.div.select(`#${t}`).property("checked",!0),!0}})),this}}let Ni=Kt("#setting"),Ti=new class extends Mi{constructor(t){super(t),this.numSections=0,this.names=new Array,this.div.attr("class","accordion")}append(t){t.forEach((t=>{this.appendItem(t)}))}appendItem(t){let e=`${this.id}-heading${this.numSections}`,n=this.innerBodyID(this.numSections),r=`${this.id}-content${this.numSections}`,i=void 0===t.collapse||t.collapse,o=this.div.append("div").attr("class","accordion-item");o.append("h2").attr("class","accordion-header").attr("id",e).append("button").attr("class","accordion-button collapsed").attr("type","button").attr("data-bs-toggle","collapse").attr("data-bs-target",`#${n}`).attr("aria-expanded","false").attr("aria-controls",n).text(t.name);let a=o.append("div").attr("id",n).attr("class","accordion-collapse collapse"+(!1===i?" show":"")).attr("aria-labelledby",e).append("div").attr("class","accordion-body").attr("id",r);t.widgets.forEach((t=>{a.append((()=>t.node()))})),this.numSections+=1,this.names.push(t.name)}innerBodyID(t){return`${this.id}-collapse${t}`}show(t){this.names.some(((e,n)=>{if(e===t){let t=this.innerBodyID(n);return this.div.select(`#${t}`).attr("class","accordion-collapse collapse show"),!0}}))}}("accordion-setting");function Di(t){let e=(n=t.ticker,new Ei("player-setting").append([{label:"Speed: rate of ticks per second",widgets:[new Ci("player-speed-radio").append(["1X","2X","4X"]).switch("1X").event((t=>{n.signal.state("pause"),console.log(t),"1X"===t?n.signal.speed(1):"2X"===t?n.signal.speed(2):"4X"===t?n.signal.speed(4):console.error("internal error in radio for speed setting")}))]},{label:"Step: rate of time slices per tick",widgets:[new Ai("player-step-input").append({label:"time slices per tick",placeholder:"1"}).event((t=>{n.signal.state("pause");const e=Number(t);Number.isNaN(e)?console.error("NaN is not allowed for step setting"):n.signal.step(e)}))]},{label:"Mode: tick slice or tick end time",widgets:[new Ci("player-mode-radio").append(["Slice Tick","Range Tick"]).switch("Slice Tick").event((t=>{console.log(t),n.signal.state("pause"),"Slice Tick"===t?n.signal.mode("slice"):"Range Tick"===t?n.signal.mode("range"):console.error("internal error in radio for mode setting")}))]}]));var n;let r=function(t,e,n){return new Ei("filter-setting").append([{label:"Message Filter",widgets:[new Ci("filter-msg-radio").append(["Groups","Data/Command"]).switch("Groups").event((r=>{t.signal.state("pause"),console.log(r),"Groups"===r?(n.signal.msg("group"),e.signal.msg("group")):"Data/Command"===r?(n.signal.msg("doc"),e.signal.msg("doc")):console.error("internal error in radio for message filter setting")}))]}])}(t.ticker,t.filterBar,t.filterModule);Ti.append([{name:"Player",widgets:[e]},{name:"Filter",widgets:[r]}]),Ni.append((()=>Ti.node()))}class zi{constructor(t,e){this.marginTop=30,this.marginRight=5,this.marginBottom=30,this.marginLeft=40,this.xPadding=.1;const n=k(t,e.x),r=k(t,e.y),i=k(t,e.z);let o,a;o=e.xDomain,a=e.zDomain,void 0===e.xDomain&&(o=n),void 0===e.zDomain&&(a=i),o=new u(o),a=new u(a);const s=y(n.length).filter((t=>o.has(n[t])&&a.has(i[t]))),l=void 0===e.order?Br:e.order,c=function(t,e,...n){return m(t,d,e,n)}(s,(([t])=>t),(t=>n[t]),(t=>i[t])),h=function(){var t=Dr([]),e=Br,n=Xr,r=Fr;function i(i){var o,a,s=Array.from(t.apply(this,arguments),Yr),u=s.length,l=-1;for(const t of i)for(o=0,++l;o<u;++o)(s[o][l]=[0,+r(t,s[o].key,l,i)]).data=t;for(o=0,a=Tr(e(s));o<u;++o)s[a[o]].index=o;return n(s,a),s}return i.keys=function(e){return arguments.length?(t="function"==typeof e?e:Dr(Array.from(e)),i):t},i.value=function(t){return arguments.length?(r="function"==typeof t?t:Dr(+t),i):r},i.order=function(t){return arguments.length?(e=null==t?Br:"function"==typeof t?t:Dr(Array.from(t)),i):e},i.offset=function(t){return arguments.length?(n=null==t?Xr:t,i):n},i}().keys(a).value((([t,e],n)=>r[e.get(n)])).order(l).offset(e.offset)(c).map((t=>t.map((e=>Object.assign(e,{i:e.data[1].get(t.key)})))));let f;f=void 0===e.yDomain?function(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}(h.flat(2)):e.yDomain,null!=e.marginTop&&(this.marginTop=e.marginTop),null!=e.marginRight&&(this.marginRight=e.marginRight),null!=e.marginBottom&&(this.marginBottom=e.marginBottom),null!=e.marginLeft&&(this.marginLeft=e.marginLeft),null!=e.xPadding&&(this.xPadding=e.xPadding);let p=[this.marginLeft,e.width-this.marginRight],g=[e.height-this.marginBottom,this.marginTop];null!=e.xRange&&(p=e.xRange),null!=e.yRange&&(g=e.yRange);const v=void 0===e.yType?wr:e.yType,w=Wn(o,p).paddingInner(this.xPadding),b=v(f,g),_=jn(a,e.colors),x=(M=w,T(3,M)).tickSizeOuter(0).tickValues(w.domain().filter((function(t,e){const n=document.body.clientWidth,r=Math.floor(n/40);return!(e%Math.floor(w.domain().length/r))})));var M;const S=function(t){return T(4,t)}(b).ticks(e.height/60,e.yFormat);let A;if(void 0===e.title){const t=b.tickFormat(100,e.yFormat);A=e=>`${n[e]}\n${i[e]}\n${t(r[e])}`}else{const e=k(t,(t=>t)),n=A;A=r=>n(e[r],r,t)}this.X=n,this.Y=r,this.Z=i,this.I=s,this.width=e.width,this.height=e.height,this.xAxis=x,this.yAxis=S,this.xScale=w,this.yScale=b,this.yLabel=e.yLabel,this.series=h,this.color=_,this.title=A}axis(){const t=Ut("svg").attr("width",this.width).attr("height",this.height).attr("viewBox",`0 0 ${this.width} ${this.height}`).attr("style","max-width: 100%; height: auto; height: intrinsic;");t.append("g").attr("transform",`translate(${this.marginLeft},0)`).call(this.yAxis).call((t=>t.select(".domain").remove())).call((t=>t.selectAll(".tick line").clone().attr("x2",this.width-this.marginLeft-this.marginRight).attr("stroke-opacity",.1))).call((t=>t.append("text").attr("x",-this.marginLeft).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text(this.yLabel)));let e=this.yScale(0);return Number.isNaN(e)&&(e=this.height-this.marginBottom),t.append("g").attr("transform",`translate(0,${e})`).call(this.xAxis),t}bar(t,e){const n=this.xScale,r=this.yScale,i=t.append("g").attr("id",void 0===e?"bar":e),o=i.selectAll("g").data(this.series).join("g").attr("fill",(([{i:t}])=>this.color(this.Z[t]))).selectAll("rect").data((t=>t)).join("rect").attr("x",(({i:t})=>n(this.X[t]))).attr("y",(([t,e])=>Math.min(r(t),r(e)))).attr("height",(([t,e])=>Math.abs(r(t)-r(e)))).attr("width",n.bandwidth());return this.title&&o.append("title").text((({i:t})=>this.title(t))),i}area(t,e){const n=this.xScale,r=this.yScale,i=t,o=Pr().x(((t,e)=>n(this.X[e])+.5*n.bandwidth())).y0((([t,e])=>Math.min(r(t),r(e)))).y1((([t,e])=>Math.max(r(t),r(e)))),a=i.append("g").attr("id",void 0===e?"area":e);return a.selectAll("path").data(this.series).join("path").style("fill",(([{i:t}])=>this.color(this.Z[t]))).attr("d",o),a}brush(t,e){const n=this.xScale,r=([t,e])=>[n(this.X[t]),n(this.X[e-1])+n.bandwidth()],i=In(Nn).extent([[this.marginLeft,this.marginTop],[this.width-this.marginRight,this.height-this.marginBottom]]).on("start brush end",(function(t){if(!t.sourceEvent&&!t.selection)return;const i=t.selection?t.selection:[1,2].fill(t.sourceEvent.offsetX),o=Oi(n,i[0],i[1]);if(t.sourceEvent&&"end"===t.type){const n=r(o);Kt(this).transition().call(t.target.move,n),Kt(this).select("title").text(`TODO: [${o[0]}, ${o[1]})`),Ri(o[0])&&Ri(o[1])&&e(o[0],o[1])}}));return t.append("g").attr("class","brush").call(i).append("title"),i}node(t){const e=this.color;return Object.assign(t.node(),{scales:{color:e}})}}function Ri(t){return/^-?\d+$/.test(t)}function Oi(t,e,n){const r=t.step();let i,o,a=t.range()[0]+t.paddingOuter();return e==n?(i=e-a<0?0:Math.ceil((e-a)/r),o=Math.ceil((n-a)/r)):(i=e-a<0?0:Math.round((e-a)/r),o=Math.round((n-a)/r)),o==i&&(0==i?++o:--i),[i,o]}const $i=Kt("#timebar"),Pi=kr,Xi=ui.reduce(((t,e,n)=>({...t,[e]:Pi[li][n]})),{}),Bi=di.reduce(((t,e,n)=>({...t,[e]:["#d7191c","#2b83ba"][n]})),{});let Fi={x:t=>t.id,y:t=>t.count,z:t=>t.group,width:0,height:0,offset:Xr,yLabel:"Count",zDomain:ui,colors:Pi[li]};function Yi(t,e,n,r){t.flat(1).then((t=>{const i=new qi(e,n,t);i.render();const o=$i.select(".resizer");!function(t,e,n){const r=t.node();e.on("mouseover",(function(){Kt(this).transition().style("background-color","#bdbdbd")})).on("mousedown",function(){let t=0,e=0;const i=function(i){const o=t-i.clientY;e+o>=65?(r.style.height=`${e+o}px`,n(o)):r.style.height="0px"},o=function(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};return function(n){t=n.clientY;const a=window.getComputedStyle(r);e=parseInt(a.height,10),document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}}()).on("mouseout",(function(){Kt(this).transition().style("background-color",null)}))}($i,o,(()=>i.render())),Kt(window).on("resize",(()=>i.render())),n.setCast(((t,e)=>i.moveBrush(t,e))),r.AppendForMsgGroup((t=>i.updateMsgGroupDomain(t))),r.AppendForDataOrCommand((t=>i.updateDataOrCommandDomain(t)))}))}class qi{constructor(t,e,r){this.controller=t,this.ticker=e,this.dataForMsgGroups=function(t){const e=g(t,(t=>Math.log2(Number(v(t,(t=>t.count)))+1)),(t=>String(t.id)),(t=>t.group));return Array.from(e,(([t,e,n])=>({id:t,group:e,count:n}))).sort((function(t,e){return n(t.group,e.group)}))}(r),this.dataForDoC=function(t){const e=g(t,(t=>Math.log2(Number(v(t,(t=>t.count)))+1)),(t=>String(t.id)),(t=>t.doc));return Array.from(e,(([t,e,n])=>({id:t,doc:e,count:n}))).sort((function(t,e){return n(t.doc,e.doc)}))}(r),this.data=this.dataForMsgGroups}updateMsgGroupDomain(t){Fi.z=t=>t.group,Fi.zDomain=t,Fi.colors=t.map((t=>Xi[t])),this.data=this.dataForMsgGroups,this.render()}updateDataOrCommandDomain(t){Fi.z=t=>t.doc,Fi.zDomain=t,Fi.colors=t.map((t=>Bi[t])),this.data=this.dataForDoC,this.render()}render(){$i.selectAll("svg").remove(),Fi.width=$i.node().getBoundingClientRect().width,Fi.height=$i.node().getBoundingClientRect().height;let t=new zi(this.data,Fi),e=t.axis();t.bar(e);let n=t.brush(e,((t,e)=>{this.ticker.signal.state("pause"),this.controller.startTime=t,this.controller.endTime=e,this.controller.requestDataPort()}));$i.append((()=>t.node(e))),this.chart=t,this.svg=e,this.brush=n}moveBrush(t,e){if(e<1)return;if(t>e)return void console.error("Left position of brush cannot be greater than right");const n=this.chart,r=n.xScale(`${t}`),i=n.xScale(""+(e-1))+n.xScale.bandwidth();this.svg.select(".brush").call(this.brush.move,[r,i])}}class Ii extends Mi{constructor(t){super(t),this.div.style("margin","0.25rem").style("display","inline-block").style("font-size","0.85em")}append(t){this.color=void 0===t.color?"blue":t.color;const e=void 0===t.boxSize?21:t.boxSize;return this.div.append("svg").attr("width",e).attr("height",e).style("margin","0.25em").append("rect").attr("width",e).attr("height",e).attr("stroke","grey").attr("stroke-width",3).attr("fill","none").attr("rx",3).attr("ry",3).property("checked",!1),this.div.append("label").text(t.label).style("margin","0.25em").style("vertical-align","initial"),this}event(t){const e=this.color;return this.div.select("svg").on("click",(function(){let n=Kt(this).select("rect");!1===n.property("checked")?(n.property("checked",!0).transition().attr("fill",e),t(!0)):(n.property("checked",!1).transition().attr("fill","none"),t(!1))})),this}static(t){const e=this.div.select("rect");return t?e.property("checked",!0).transition().attr("fill",this.color):e.property("checked",!1).transition().attr("fill","none"),this}switch(t){return this.static(!t),this.div.select("svg").dispatch("click"),this}}const Li=Kt("#filterbar"),Gi={MsgGroup:Li.append("div").attr("id","filter-msg-group").style("display","none"),DataOrCommand:Li.append("div").attr("id","filter-data-or-command").style("display","none")};Li.append("div").attr("id","filter-edge-less").style("display","none"),Li.append("div").attr("id","filter-edge-more").style("display","none");let ji=ui.reduce(((t,e)=>({...t,[e]:!0})),{}),Wi=di.reduce(((t,e)=>({...t,[e]:!0})),{});class Vi{constructor(t){this.updaterMsgGroup=new Array,this.updaterDataOrCommand=new Array,this.ticker=t}AppendForMsgGroup(t){this.updaterMsgGroup.push(t)}FireEventForMsgGroup(t){this.ticker.signal.state("pause"),this.updaterMsgGroup.forEach((e=>{e(t)})),this.ticker.signal.state("still")}AppendForDataOrCommand(t){this.updaterDataOrCommand.push(t)}FireEventForDataOrCommand(t){this.ticker.signal.state("pause"),this.updaterDataOrCommand.forEach((e=>{e(t)})),this.ticker.signal.state("still")}}class Hi{constructor(t){this.signal={},this.ev=t,this.initSignalCallbacks()}initSignalCallbacks(){this.signal.msg=t=>{if("group"===t){Gi.DataOrCommand.style("display","none"),Gi.MsgGroup.style("display","inline-block");const t=ui.filter((t=>ji[t]));this.ev.FireEventForMsgGroup(t)}else if("doc"===t){Gi.DataOrCommand.style("display","inline-block"),Gi.MsgGroup.style("display","none");const t=di.filter((t=>Wi[t]));this.ev.FireEventForDataOrCommand(t)}},this.signal.edge=t=>{}}renderFilterMsgGroup(){ui.forEach(((t,e)=>{let n=(new Ii).append({label:t,color:kr[li][e]}).event((e=>this.updateMsgGroup(t,e))).static(!0);Gi.MsgGroup.append((()=>n.node()))}))}updateMsgGroup(t,e){ji[t]=e;let n=ui.filter((t=>ji[t]));console.log(n),this.ev.FireEventForMsgGroup(n)}renderFilterDataOrCommand(){di.forEach(((t,e)=>{let n=(new Ii).append({label:(r=t,"D"===r?"Data":"C"===r?"Command":(console.error("Invalid input in DataOrCommandDomainNameExtend"),"Invalid")),color:["#d7191c","#2b83ba"][e]}).event((e=>this.updateDataOrCommand(t,e))).static(!0);var r;Gi.DataOrCommand.append((()=>n.node()))}))}updateDataOrCommand(t,e){Wi[t]=e;let n=di.filter((t=>Wi[t]));console.log(n),this.ev.FireEventForDataOrCommand(n)}}let Ki=document.getElementById("graph"),Ui=new class{constructor(t){this.conn=new ki(t)}rangeInner(t,e,n){return this.conn.isClosed()?(console.error("DataPort cannot send `range`, connection not works"),!1):(this.conn.send(`range ${t} ${e}`,n),!0)}flatInner(t,e){return this.conn.isClosed()?(console.error("DataPort cannot send `flat`, connection not works"),!1):(this.conn.send(`flat ${t}`,e),!0)}init(){return new Promise(((t,e)=>{!1===this.rangeInner(0,0,(e=>{t(JSON.parse(e).meta)}))&&e(new Error("DataPort cannot handle `init`"))}))}range(t,e){return new Promise(((n,r)=>{!1===this.rangeInner(t,e,(t=>{n(JSON.parse(t))}))&&r(new Error("DataPort cannot handle `range`"))}))}flat(t){return new Promise(((e,n)=>{!1===this.flatInner(t,(t=>{e(JSON.parse(t))}))&&n(new Error("DataPort cannot handle `flat`"))}))}}("ws://127.0.0.1:8080/");Ui.init().then((t=>{console.log(t);let n=new xi(+t.elapse),r=function(t){let e=new Si("player-button");return Kt("#player-status").append((()=>e.append([{name:"Play",color:"btn-secondary",html:'<svg transform="scale(1.2)" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" fill="white" class="bi bi-play" viewBox="0 0 16 16">\n      <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>\n    </svg>'},{name:"Pause",color:"btn-primary",html:'<svg transform="scale(1.2)" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" fill="white" class="bi bi-pause" viewBox="0 0 16 16">\n      <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>\n    </svg>'}]).event((e=>{"Play"===e?t.signal.state("auto"):"Pause"===e&&t.signal.state("pause")})).node())),e}(n),i=new Vi(n),o=new wi(i),a=new e(Ui,new si(Ki,ai)).loadModules([o,new bi]);n.bindController(a).setStatusChangeCallback((t=>{r.static(t?"Pause":"Play")})),a.requestDataPort(),Yi(Ui,a,n,i),Di({ticker:n,filterBar:function(t){let e=new Hi(t);return e.renderFilterMsgGroup(),e.signal.msg("group"),e.renderFilterDataOrCommand(),e}(i),filterModule:o});let s=[function(){r.switch("Play")},function(){r.switch("Pause")}],u=0;document.addEventListener("keydown",(function(t){"p"===t.key&&(s[u](),u=(u+1)%s.length)}))}));
//# sourceMappingURL=index.e75856dd.js.map
